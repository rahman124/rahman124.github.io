[{"content":"When services are deployed to kubernetes, it is necessary to configure how to expose and redirect traffic to them from outside the cluster.\nIn this blog post I will show you how you can set up Traefik ingress routers to redirect HTTP traffic to HTTPS.\nThis post assumes you have Traefik deployed in your cluster with the kubernetes ingress and kubernetescrd provider, as well as the TLS certificate you want to use loaded on to it.\nEnsure you have entrypoints defined in your kubernetes deployment, with ports 80 and 443 defined for web and websecure traffic respectively.\n EntryPoints are the network entry points into Traefik. They define the port which will receive the packets, and whether to listen for TCP or UDP.\n  Deploy first router In order to have Traefik listen to requests on HTTPS, you\u0026rsquo;ll need to include a TLS section in your ingress definition. Here is an example definition of our first router:\n--- kind: Ingress apiVersion: networking.k8s.io/v1 metadata: name: traefik-ingress namespace: example annotations: traefik.ingress.kubernetes.io/router.entrypoints: websecure traefik.ingress.kubernetes.io/router.tls: \u0026#34;true\u0026#34; spec: rules: - host: websecure.example.io http: paths: - backend: service: name: example port: number: 80 path: / pathType: ImplementationSpecific tls: - hosts: - websecure.example.io We incorporate the traefik.ingress.kubernetes.io/router.entrypoints annotation with value websecure only.\nHowever, as per the Traefik documentation, this will instruct our router to ignore HTTP (non TLS) requests.\nWe want to have our service listen on both HTTP and HTTPS. To do this we\u0026rsquo;ll need to deploy a second router dedicated to HTTP traffic, but first let\u0026rsquo;s have a look at Middleware.\n Middleware The documentation explains it well, so I\u0026rsquo;ll just copy the definition here:\n Attached to the routers, pieces of middleware are a means of tweaking the requests before they are sent to your service (or before the answer from the services are sent to the clients).\n That sounds good, we want to redirect all HTTP requests to HTTPS, so lets deploy the Middleware:\n--- apiVersion: traefik.containo.us/v1alpha1 kind: Middleware metadata: name: redirect namespace: example spec: redirectScheme: scheme: https permanent: true Now we need to attach this to our HTTP router, so let\u0026rsquo;s proceed with it\u0026rsquo;s creation.\n Deploy second router Here is the definition for our second router:\n--- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: ingress-redirect namespace: example annotations: traefik.ingress.kubernetes.io/router.entrypoints: web traefik.ingress.kubernetes.io/router.middlewares: example-redirect@kubernetescrd spec: rules: - host: websecure.example.io http: paths: - backend: service: name: example port: number: 80 path: / pathType: ImplementationSpecific We specify the entrypoint as web this time as it will listen for HTTP requests only.\nOur middleware is attached with the traefik.ingress.kubernetes.io/router.middlewares annotation.\nThe value we associate is in the format \u0026lt;namespace\u0026gt;-\u0026lt;middleware-name\u0026gt;@kubernetescrd By doing this we also avoid global redirection for all our other services in the cluster\n Great, I hope that helps with how you can redirect requests from outside your kubernetes cluster into your services.\n","permalink":"https://rahman124.github.io/posts/traefik-https-redirect/","summary":"When services are deployed to kubernetes, it is necessary to configure how to expose and redirect traffic to them from outside the cluster.\nIn this blog post I will show you how you can set up Traefik ingress routers to redirect HTTP traffic to HTTPS.\nThis post assumes you have Traefik deployed in your cluster with the kubernetes ingress and kubernetescrd provider, as well as the TLS certificate you want to use loaded on to it.","title":"Set up Traefik Kubernetes Ingress for HTTP and HTTPS with redirect to HTTPS"},{"content":"In this blog post I will show you how you can send your emails from Exim to Office 365 via a TLS connector.\nI will discuss the steps that I took to configure this in our environment so that you may have an easier time if you decide to go down the same route aswell. Prerequisites In the Exchange admin center, you will need to have your TLS certificate domain configured as an accepted domain in your Office 365 organisation.\nTo configure an accepted domain, you need to go to the Microsoft 365 admin center, click Settings \u0026gt; Domains and add your domain from there.\nAnd of course you need your TLS certificate to use with the connector. Exchange setup To start, create your connector in the Exchange admin center\nOn the left sidebar click Mail flow \u0026gt; Connectors \u0026gt; Add a connector\nOn the New Connector page, click Your organization\u0026rsquo;s email server for the Connection from, then click Next\nSpecify a name for your connector and description on the Connector name page\nOn the Authenticating sent email page, enter the domain name for your certificate\nOnce done, review the details and if it\u0026rsquo;s all good, click Create connector. You should then see it on the Connectors page. Exim setup As per Microsoft documentation, you need to enable TLS on Exim.\nTo do this, on your exim.conf file set the TLS certificate and key like so\ntls_certificate = /etc/ssl/my-cert.crt tls_privatekey = /etc/ssl/my-key.key \nHowever, we are not done yet. While this will enable TLS on Exim, it is only good for when Exim is acting as a server. In our case we want Exim to act as a client.\nIf we look at the Exim docs part 9\n The tls_certificate and tls_privatekey options of the smtp transport provide the client with a certificate, which is passed to the server if it requests it.\n \nEssentially the global option we specified above is not automatically passed on to the smtp transport.\nIn exim.conf, set the certificate in the smtp transport as such\nremote_smtp: driver = smtp . . . hosts_require_tls = * tls_certificate = /etc/ssl/my-cert.crt tls_privatekey = /etc/ssl/my-key.key I also set hosts_require_tls to force TLS for all outbound mail. All good now! If you send some test emails from Exim, you can check they were sent via our connector by the Exchange admin center.\nOn the admin page, left sidebar, click Reports \u0026gt; Mail flow \u0026gt; Inbound messages report\nHere you can verify that the TLS connector was used, as well as some other stats.\n","permalink":"https://rahman124.github.io/posts/exim-relay-connector/","summary":"In this blog post I will show you how you can send your emails from Exim to Office 365 via a TLS connector.\nI will discuss the steps that I took to configure this in our environment so that you may have an easier time if you decide to go down the same route aswell. Prerequisites In the Exchange admin center, you will need to have your TLS certificate domain configured as an accepted domain in your Office 365 organisation.","title":"Configure a certificate-based connector to relay email from Exim to Office 365"},{"content":"\u0026ldquo;Passion, Vision, Aggression, Mindset\u0026rdquo;\nA driven platform engineer, always looking to grow and develop myself both as an engineer and as an individual.\nMy technical work involves, but not limited to, Microsoft Azure, Network Virtual Appliances, Kubernetes, APM and more. Certifications: Microsoft Certified: Azure Fundamentals\nMicrosoft Certified: Azure Administrator Associate Tech specs This site was built with Hugo using the PaperMod theme.\nHosted using GitHub Pages.\nShoutouts to the creators for the easy and intuitive tools to publish this site.\n","permalink":"https://rahman124.github.io/about/","summary":"\u0026ldquo;Passion, Vision, Aggression, Mindset\u0026rdquo;\nA driven platform engineer, always looking to grow and develop myself both as an engineer and as an individual.\nMy technical work involves, but not limited to, Microsoft Azure, Network Virtual Appliances, Kubernetes, APM and more. Certifications: Microsoft Certified: Azure Fundamentals\nMicrosoft Certified: Azure Administrator Associate Tech specs This site was built with Hugo using the PaperMod theme.\nHosted using GitHub Pages.\nShoutouts to the creators for the easy and intuitive tools to publish this site.","title":"About"}]